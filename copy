jQuery(document).ready(function ($) {
    // Listen for changes in the post_type select field
    $(document).on('change', '[data-setting="post_type"]', function () {
        var selectedPostType = $(this).val();
        var $postSelect = $(this).closest('.elementor-control').siblings().find('[data-setting="selected_posts"]');

        // Make AJAX request to get posts based on selected post type
        $.ajax({
            url: elementor.ajaxurl,
            type: 'POST',
            data: {
                action: 'get_dynamic_post_options',
                post_type: selectedPostType,
                _nonce: elementor.config.nonce,
            },
            success: function (response) {
                // Clear existing options
                $postSelect.empty();

                // Populate select2 with new posts
                $.each(response, function (id, title) {
                    var newOption = new Option(title, id, false, false);
                    $postSelect.append(newOption).trigger('change');
                });
            },
        });
    });
});