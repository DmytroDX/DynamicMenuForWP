wp.domReady(() => {
    // Регістрація існуючих стилів (якщо ще не зареєстровані)
    wp.blocks.registerBlockStyle('core/list', {
        name: 'list-with-small-dots',
        label: 'List with Small Dots',
    });

    wp.blocks.registerBlockStyle('core/list', {
        name: 'list-body-style',
        label: 'List Body Style',
    });

    wp.blocks.registerBlockStyle('core/list', {
        name: 'bullet-list',
        label: 'Bullet List',
    });
});

wp.hooks.addFilter(
    'editor.BlockEdit',
    'custom/list-block-color-control',
    addColorControl
);

function addColorControl(BlockEdit) {
    return (props) => {
        const { attributes, setAttributes, name, className } = props;

        // Перевіряємо чи це блок core/list і чи має один з наших стилів
        if (name !== 'core/list' || !['is-style-list-with-small-dots', 'is-style-list-body-style', 'is-style-bullet-list'].some(style => className.includes(style))) {
            return <BlockEdit {...props} />;
        }

        const { bulletColor } = attributes;

        return (
            <>
                <BlockEdit {...props} />
                <wp.blockEditor.InspectorControls>
                    <wp.components.PanelBody title="Bullet Color Settings" initialOpen={true}>
                        <wp.components.ColorPalette
                            value={bulletColor}
                            onChange={(color) => setAttributes({ bulletColor: color })}
                        />
                    </wp.components.PanelBody>
                </wp.blockEditor.InspectorControls>
            </>
        );
    };
}

wp.hooks.addFilter(
    'blocks.getSaveContent.extraProps',
    'custom/additional-list-bullet-color-props',
    addCustomBulletColorProp
);

function addCustomBulletColorProp(extraProps, blockType, attributes) {
    if (blockType.name === 'core/list' && attributes.bulletColor) {
        extraProps.style = {
            ...extraProps.style,
            '--bullet-color': attributes.bulletColor,
        };
    }

    return extraProps;
}