// Додаємо панель для вибору кольору для кожного елемента списку
wp.hooks.addFilter(
    'editor.BlockEdit',
    'custom/list-item-color-control',
    (BlockEdit) => (props) => {
        const { attributes, setAttributes, name, className } = props;

        // Перевіряємо, чи це core/list і чи є елементами списку
        if (name !== 'core/list') {
            return <BlockEdit {...props} />;
        }

        // Додаємо колір для кожного елемента списку
        const { bulletColors = [] } = attributes;

        const updateBulletColor = (index, color) => {
            const newBulletColors = [...bulletColors];
            newBulletColors[index] = color;
            setAttributes({ bulletColors: newBulletColors });
        };

        // Отримуємо кількість елементів списку (li) в блоці
        const listItems = props.attributes.values ? props.attributes.values.split('\n') : [];

        return (
            <>
                <BlockEdit {...props} />
                <wp.blockEditor.InspectorControls>
                    <wp.components.PanelBody title="Bullet Color for List Items" initialOpen={true}>
                        {listItems.map((item, index) => (
                            <div key={index}>
                                <p>Color for item {index + 1}</p>
                                <wp.components.ColorPalette
                                    value={bulletColors[index]}
                                    onChange={(color) => updateBulletColor(index, color)}
                                />
                            </div>
                        ))}
                    </wp.components.PanelBody>
                </wp.blockEditor.InspectorControls>
            </>
        );
    }
);

// Додаємо кастомний стиль зі змінною --bullet-color для кожного елемента списку
wp.hooks.addFilter(
    'blocks.getSaveContent.extraProps',
    'custom/list-item-bullet-color-props',
    (extraProps, blockType, attributes) => {
        if (blockType.name === 'core/list') {
            const { bulletColors = [] } = attributes;

            // Додаємо стилі на кожен елемент списку (li)
            extraProps.children = extraProps.children.map((child, index) => {
                if (bulletColors[index]) {
                    return React.cloneElement(child, {
                        style: {
                            ...child.props.style,
                            '--bullet-color': bulletColors[index],
                        },
                    });
                }
                return child;
            });
        }
        return extraProps;
    }
);